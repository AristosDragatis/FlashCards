cmake_minimum_required(VERSION 3.10)
project(DynamicProject)

# ğŸ”¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ .cpp Î±ÏÏ‡ÎµÎ¯Ï‰Î½ ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿
file(GLOB CPP_FILES "*.cpp")

# ğŸ”¹ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ SQLite3
set(SQLITE3_PATH "./sqlite3")  
add_library(SQLite3 STATIC ${SQLITE3_PATH}/sqlite3.c)

# ğŸ”¹ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ¬Î¸Îµ .cpp Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î³Î¹Î± `main()`
foreach(SOURCE ${CPP_FILES})
    file(READ ${SOURCE} CONTENTS)
    if (CONTENTS MATCHES "int main[ \t\n\r]*\\(")
        get_filename_component(EXECUTABLE_NAME ${SOURCE} NAME_WE)

        # ğŸ”¹ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… `Database.cpp` ÏƒÏ„Î¿ executable
        add_executable(${EXECUTABLE_NAME} ${SOURCE} Database.cpp)

        # ğŸ”¹ Î£ÏÎ½Î´ÎµÏƒÎ· Ï„Î¿Ï… Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ Î¼Îµ SQLite3
        target_link_libraries(${EXECUTABLE_NAME} SQLite3)
        target_include_directories(${EXECUTABLE_NAME} PRIVATE ${SQLITE3_PATH})

        message(STATUS "Created target: ${EXECUTABLE_NAME} from ${SOURCE}")
    endif()
endforeach()
